name: Test Ubicloud Prod Runners

on:
  push:
    branches: [memory-check]
  
jobs:
  test:
    name: ${{ matrix.runs-on }} 
    strategy:
      fail-fast: false
      matrix:
        runs-on: [ubuntu-22.04, ubicloud-standard-2-ubuntu-2204, ubuntu-24.04, ubicloud-standard-2-ubuntu-2404, ubicloud-standard-4-ubuntu-2204]
    runs-on: ${{ matrix.runs-on }}
    steps:
      - name: checkout
        uses: actions/checkout@v4

      - name: free -h
        run: free -h

      - name: vmstat -s -S M
        run: vmstat -s -S M

      - name: sudo apt-get install smem
        continue-on-error: true
        run: |
          sudo apt-get update
          sudo apt-get install smem

      - name: smem -tkr
        continue-on-error: true
        run: smem -tkr
