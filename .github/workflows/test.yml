name: Test Ubicloud Prod Runners

on:
  push:
    branches:
      - check-azure-cli

jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        runs-on: [
          ubicloud-standard-2-ubuntu-2204, ubicloud-standard-2-ubuntu-2404,
          ubuntu-22.04, ubuntu-24.04
        ]
    runs-on: ${{ matrix.runs-on }}
    name: ${{ matrix.runs-on }}
    steps:
      - run: python3 --version
      - run: python --version
      # - run: |
      #     sudo find /opt/az -name '*.pyc' -print
      #     sudo find /opt/az/azcliextensions/azure-devops/azext_devops -name '*.pyc' -delete
      #     sudo find /opt/az/bin/ -name '*.pyc' -delete
      #     sudo find /opt/az/lib/python3.12/lib2to3 -name '*.pyc' -delete
      #     sudo find /opt/az/lib/python3.12/__pycache__/ -name '*.pyc' -delete
      #     sudo find /opt/az/lib/python3.12/site-packages/setuptools -name '*.pyc' -delete
      #     az extension add --name account --debug
      # - run: |
      #     # Prevent script from exiting on command failures
      #     set +e
          
      #     found_success=false
          
      #     for dir in $(find /opt/az/lib/python3.12/site-packages/pip/_vendor/ -maxdepth 1 -type d | sort); do
      #       dir_name=$(basename "$dir")
      #       if [ "$dir_name" = "_vendor" ]; then
      #         continue
      #       fi
      #       echo "Testing directory: $dir_name"
      #       sudo find "/opt/az/lib/python3.12/site-packages/pip/_vendor/$dir_name" -name '*.pyc' -print
      #       sudo find "/opt/az/lib/python3.12/site-packages/pip/_vendor/$dir_name" -name '*.pyc' -delete

      #       # Run the az command
      #       az extension add --name account --debug
      #       exit_code=$?
            
      #       # Check the exit code
      #       if [ $exit_code -eq 0 ]; then
      #         echo "Success with directory: $dir_name"
      #         found_success=true
      #         break
      #       else
      #         echo "Failed with directory: $dir_name. Continuing..."
      #       fi
      #     done
          
      #     if [ "$found_success" = true ]; then
      #       echo "Found a working directory!"
      #     else
      #       echo "No working directory found, but continuing workflow."
      #     fi
          
      #     # Ensure the script exits with success
      #     exit 0
      # - run: az version
      # - run: az upgrade --yes
      # - run: az version
      # - run: ls -lah /opt/az/bin
      # - run: /opt/az/bin/python3 --version
      - run: ls -lah /opt/az/lib/python3.12/site-packages/pip/_vendor/rich/__pycache__/_emoji_codes.cpython-312.pyc
      # - run: |
      #     md5=($(md5sum /opt/az/lib/python3.12/site-packages/pip/_vendor/rich/__pycache__/_emoji_codes.cpython-312.pyc))
      #     echo $md5
      # - run: sudo rm -rf /opt/az/lib/python3.12/site-packages/pip/_vendor/rich/__pycache__/_emoji_codes.cpython-312.pyc
      - run: az extension add --name account --debug
      - run: az version
